{%extends "base.html"%}
{% load static %}
{%block content%}
<div class="container">
    <ul class="list-group">
        {%for post in post_list%}
            <li class="list-group-item post-item">
                <div class="preview-post-title">
                    <h3><a href="{%url 'post_detail' pk=post.pk%}" data-href="{%url 'view_post' pk=post.pk%}" class="post-link" id="post_{{post.pk}}"><span>{{post.title}}</span></a></h3>
                </div>
                <div class="preview-post-date">
                    <p>Created on: {{post.create_time|date:"N d, Y"}} by: {{post.author}}</p>
                </div>
                <div class="preview-post-content">
                    <p>
                      {%if post.content|length > 140%}
                        {{post.content|slice:":140"}}...
                      {%else%}
                        {{post.content}}
                      {%endif%}
                    </p>
                </div>
                <div class="preview-visit-stats">
                  <table>
                    <tr>
                      <td id="liked-count_{{post.pk}}" class="stats"><img src="{%static 'img/icons/red_heart.png'%}" width=20 height=20 alt=""> {{post.liked_by.count}}</td>
                      <td id="marked-count_{{post.pk}}" class="stats"><img src="{%static 'img/icons/star.png'%}" width=20 height=20 alt="">{{post.marked_by.count}}</td>
                      <td id="viewed-count_{{post.pk}}" class="stats"><img src="{%static 'img/icons/view.png'%}" width=20 height=20 alt=""> {{post.viewed_count}}</td>
                      <td id="comment-count_{{post.pk}}" class="stats"><img src="{%static 'img/icons/comment.png'%}" width=20 height=20 alt="">{{post.post_comments.count}}</td>
                    </tr>
                  </table>
                </div>
            </li>
        {%endfor%}
    </ul>
</div>
<script type="text/javascript">
  $(".post-link").click(function() {
    var postData = {csrfmiddlewaretoken: '{{ csrf_token }}'};
    $.ajax({
      type: "POST",
      url: $(this).attr("data-href"),
      data: postData,
      success: function (data) {
        console.log("Hello");
      }
      error: function() {
        console.log("ADD POST COUNT ERROR.");
      }
    });
  })
</script>
 {%endblock%}
 {%block right_navbar%}
 {%endblock%}
