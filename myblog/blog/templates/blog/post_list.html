{%extends "base.html"%}
{% load static %}
{%block content%}
<div class="blog-list-container">
    <ul class="list-group">
        {%for post in page_obj%}
            {%if post.published_time%}
                <li class="list-group-item post-item">
            {%else%}
                <li class="list-group-item draft-item">
            {%endif%}
                <div class="preview-post-title">
                    <h4><a href="{%url 'post_detail' pk=post.pk%}" id="post-title-link-{{post.pk}}" class="post-title-link"><span>{{post.title}}</span></a></h4>
                </div>
                <div class="preview-post-date">
                    <p>Created on: {{post.create_time|date:"N d, Y"}} by: {{post.author}}</p>
                </div>
                <div class="preview-post-content">
                    <p>
                      {%if post.content|length > 140%}
                        {{post.content|slice:":140"|safe}}...
                      {%else%}
                        {{post.content|safe}}
                      {%endif%}
                    </p>
                </div>
                <div class="preview-visit-stats">
                      <div id="liked-count" class="stats"><img src="{%static 'img/icons/red_heart.png'%}" width=20 height=20 alt=""> {{post.liked_by.count}}</div>
                      <div id="marked-count" class="stats"><img src="{%static 'img/icons/star.png'%}" width=30 height=30 alt="">{{post.marked_by.count}}</div>
                      <div id="viewed-count" class="stats"><img src="{%static 'img/icons/view.png'%}" width=20 height=20 alt=""> {{post.viewed_count}}</div>
                      <div id="comment-count" class="stats"><img src="{%static 'img/icons/comment.png'%}" width=20 height=20 alt="">{{post.post_comments.count}}</div>
                </div>
            </li>
        {%endfor%}
    </ul>
    {%if page_obj.number%}
        <div class="pagination">
            <span class="step-links">
                {% if page_obj.has_previous %}
                    <a href="?page=1">&laquo; first</a>
                    <a href="?page={{ page_obj.previous_page_number }}">previous</a>
                {% endif %}

                <span class="current">
                    Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
                </span>

                {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}">next</a>
                    <a href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
                {% endif %}
            </span>
        </div>
    {%else%}
        <p>No content here</p>
    {%endif%}
</div>
{% csrf_token %}
<script type="text/javascript">
    csrf();
    $(".post-title-link").on("click", function() {
        var post_id = $(this).prop("id").split("-")[3];
        var url = '{%url "view_count" pk=0%}';
        console.log("HELLO");
        $.ajax({
            type: "post",
            url: url.replace("0", post_id),
            async: false,
            dataType: "json",
            success: function() {
                console.log("success")
            }
        })

    })
</script>
 {%endblock%}
 {%block right_navbar%}
 {%endblock%}
